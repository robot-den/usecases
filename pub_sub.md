#### Pub/sub данных с помощью гема private_pub
Все это есть в [readme](https://github.com/ryanb/private_pub) репозотория private_pub.   

Ставим гем и сервер для него:
```ruby
gem "private_pub"
gem "thin"
```
Генерируем файлы конфигурации:
```bash
rails g private_pub:install
```
Запускаем сервер:
```bash
rackup private_pub.ru -s thin -E production
```
Чтобы все заработало необходимо как минимум отправить данные в канал и подписать страницу на этот канал.  
Подпишем страницу, во вьюхе:
```ruby
<%= subscribe_to "/messages/new" %>
```
Отправку данных можно выполнить по разному (метод доступен везде), например:  
из контроллера:
```ruby
PrivatePub.publish_to "/messages/new", :chat_message => "Hello, world!"
```
или вьюхи:
```ruby
<% publish_to "/messages/new" do %>
  $("#chat").append("<%= j render(@messages) %>");
<% end %>
```
Если мы шлем JS (как во вьюхе), то скрипт будет автоматически выполнен после получения, если же отправляется JSON как в примере с контроллером, его необходимо дополнительно обрабатывать на клиенте:
```javascript
PrivatePub.subscribe("/messages/new", function(data, channel) {
  $("#chat").append(data.chat_message);
});
```
---
**Замечания**   
При создании каналов важно строго следить за данными и исполняемым JS, отправляемым в него. К примеру в канал не стоит слать какие-либо ошибки, предназначенные для конкретного пользователя или отправлять JS который чистит формы за пользователем после создания чего-либо.  

При создании каналов необходимо следить за их количеством и нагруженностью. Например создание общего канала "/comments" в который посылаются все комментарии для всех ресурсов приложения или создание личного канала для одинаковых ресурсов на одной странице выглядит неважно.







